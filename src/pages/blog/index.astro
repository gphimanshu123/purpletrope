---
import Layout from '../../layouts/Layout.astro';
import BlogList from '../../components/blog/BlogList';
import { loadSanityQuery } from '../../lib/sanityClient';
import groq from 'groq';
import type { BlogPostSummary } from '../../types/blog';
import type { PageHeaderContent } from '../../types/pageHeader';

export const prerender = true;

const postsQuery = groq`*[_type == "post" && defined(slug.current)] | order(publishedAt desc) {
  "id": _id,
  "title": title,
  "slug": slug.current,
  excerpt,
  publishedAt,
  tags,
  heroImage,
  mainImage,
  "coverImage": coalesce(mainImage, heroImage),
  "author": author->{
    "id": _id,
    name,
    avatar
  }
}`;

const posts = await loadSanityQuery<BlogPostSummary[]>(postsQuery);
const headerQuery = groq`*[_type == "pageHeader" && page == "blog"][0]{
  label,
  title,
  description
}`;
const header = await loadSanityQuery<Pick<PageHeaderContent, "label" | "title" | "description"> | null>(headerQuery);
---

<Layout title="Blog Â· Debjani Portfolio">
	<BlogList posts={posts ?? []} header={header ?? undefined} />
</Layout>

